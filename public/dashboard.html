<!DOCTYPE html>
<html>
<head>
<title>Manager Dashboard</title>
<style>
body{font-family:Arial;background:#f4f6f9;text-align:center}
table{margin:auto;border-collapse:collapse;width:80%;background:white;}
th,td{padding:12px;border:1px solid #ddd;}
th{background:#2d89ef;color:white;}
h1{margin-top:30px;}
</style>
</head>

<body style="background:url('pigeon.jpeg'); background-size:cover;">
<h1>Manager Monitoring Dashboard</h1>

<h2>Feeding Logs</h2>
<table id="feedTable"></table>

<br><br>

<h2>Health Reports</h2>
<table id="healthTable"></table>

<script>
const API = ""; // SAME ORIGIN

async function loadData(){
  // Feeding logs (manager-protected)
  {
    const res = await fetch(API + "/api/manager/feed-logs", { credentials:"include" });
    if(!res.ok) return; // not logged in as manager
    const data = await res.json();

    const table = document.getElementById("feedTable");
    table.innerHTML = `
      <tr>
        <th>Worker</th><th>Pigeon ID</th><th>Amount Fed (grams)</th><th>Time</th>
      </tr>`;
    data.forEach(row=>{
      table.innerHTML += `
        <tr>
          <td>${row.workerName || ""}</td>
          <td>${row.pigeonId || ""}</td>
          <td>${row.amount || ""}</td>
          <td>${row.time || ""}</td>
        </tr>`;
    });
  }

  // Health logs (manager-protected)
  {
    const res = await fetch(API + "/api/manager/health-logs", { credentials:"include" });
    const data = await res.json();

    const table = document.getElementById("healthTable");
    table.innerHTML = `
      <tr>
        <th>Worker</th><th>Pigeon</th><th>Issue</th><th>Time</th>
      </tr>`;
    data.forEach(row=>{
      table.innerHTML += `
        <tr>
          <td>${row.worker || ""}</td>
          <td>${row.pigeon_id || ""}</td>
          <td>${row.issue || ""}</td>
          <td>${row.time || ""}</td>
        </tr>`;
    });
  }
}

loadData();
setInterval(loadData, 5000);
</script>
</body>
</html>
